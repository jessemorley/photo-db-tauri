<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photographer Image Browser</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components.css">
</head>
<body>
    <!-- Initial Setup Screen -->
    <div class="initial-setup" id="initialSetup">
        <h1>Photographer Browser</h1>
        <p>Welcome! Please select a folder containing your photographer directories to get started.</p>
        <button class="select-folder-button" id="initialSelectButton">Select Photography Folder</button>
    </div>

    <!-- Main App Interface -->
    <div class="app-interface hidden" id="appInterface">
        <div class="header">
            <div class="header-left" data-tauri-drag-region></div>
            <div class="header-main">
                <div class="header-drag-area" data-tauri-drag-region></div>
                <div class="header-content">
                    <div class="nav-controls" data-tauri-drag-region>
                    <div class="nav-left" data-tauri-drag-region>
                        <button class="menu-button back-button" id="backButton">
                            <svg height="21" viewBox="0 0 21 21" width="21" xmlns="http://www.w3.org/2000/svg"><path d="m4.5 8.5-4-4 4-4" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" transform="translate(7 6)"/></svg>
                        </button>
                        <div class="current-path" id="currentPath"></div>
                    </div>
                    <div class="nav-center" data-tauri-drag-region>
                        <div class="search-container">
                            <svg class="search-icon" height="21" viewBox="0 0 21 21" width="21" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="8.5" cy="8.5" r="5"/><path d="m17.571 17.5-5.571-5.5"/></g></svg>
                            <input type="text" class="search-bar" id="searchBar">
                        </div>
                    </div>
                    <div class="nav-right" data-tauri-drag-region>
                        <button class="menu-button reveal-folder-button hidden" id="revealFolderButton" title="Reveal in Finder">
                            <svg height="21" viewBox="0 0 21 21" width="21" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" transform="translate(3 4)"><path d="m.5 1.5v9c0 1.1045695.8954305 2 2 2h10c1.1045695 0 2-.8954305 2-2v-6.00280762c.0007656-1.05436179-.8150774-1.91816512-1.8499357-1.99451426l-.1500643-.00468356-5 .00200544-2-2h-4c-.55228475 0-1 .44771525-1 1z"/><path d="m.5 2.5h7"/></g></svg>
                        </button>
                        <button class="menu-button histogram-button hidden" id="histogramButton" title="Histogram">
                            <svg height="21" viewBox="0 0 21 21" width="21" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" transform="translate(2 4)"><path d="m4.5 0c.55228475 0 1 .44771525 1 1v2c0 .55228475-.44771525 1-1 1s-1-.44771525-1-1v-2c0-.55228475.44771525-1 1-1z"/><path d="m16.5 2h-11"/><path d="m3.5 2h-3"/><path d="m4.5 10c.55228475 0 1 .4477153 1 1v2c0 .5522847-.44771525 1-1 1s-1-.4477153-1-1v-2c0-.5522847.44771525-1 1-1z"/><path d="m16.5 12h-11"/><path d="m3.5 12h-3"/><path d="m12.5 5c.5522847 0 1 .44771525 1 1v2c0 .55228475-.4477153 1-1 1s-1-.44771525-1-1v-2c0-.55228475.4477153-1 1-1z"/><path d="m11.5 7h-11"/><path d="m16.5 7h-3"/></g></svg>
                        </button>
                        <button class="menu-button eyedropper-button hidden" id="eyedropperButton" title="Eyedropper">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor" width="21" height="21">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m15 11.25 1.5 1.5.75-.75V8.758l2.276-.61a3 3 0 1 0-3.675-3.675l-.61 2.277H12l-.75.75 1.5 1.5M15 11.25l-8.47 8.47c-.34.34-.8.53-1.28.53s-.94.19-1.28.53l-.97.97-.75-.75.97-.97c.34-.34.53-.8.53-1.28s.19-.94.53-1.28L12.75 9M15 11.25 12.75 9" />
                            </svg>
                        </button>
                        <button class="menu-button gear-button" id="gearButton" title="Preferences">
                            <svg height="21" viewBox="0 0 21 21" width="21" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" transform="translate(3 3)"><path d="m7.5.5c.35132769 0 .69661025.02588228 1.03404495.07584411l.50785434 1.53911115c.44544792.12730646.86820077.30839026 1.26078721.53578009l1.4600028-.70360861c.5166435.39719686.9762801.86487779 1.3645249 1.388658l-.7293289 1.44720284c.2201691.39604534.3936959.82158734.5131582 1.2692035l1.5298263.5338186c.0390082.29913986.0591302.60421522.0591302.91399032 0 .35132769-.0258823.69661025-.0758441 1.03404495l-1.5391112.50785434c-.1273064.44544792-.3083902.86820077-.5357801 1.26078721l.7036087 1.4600028c-.3971969.5166435-.8648778.9762801-1.388658 1.3645249l-1.4472029-.7293289c-.39604532.2201691-.82158732.3936959-1.26920348.5131582l-.5338186 1.5298263c-.29913986.0390082-.60421522.0591302-.91399032.0591302-.35132769 0-.69661025-.0258823-1.03404495-.0758441l-.50785434-1.5391112c-.44544792-.1273064-.86820077-.3083902-1.26078723-.5357801l-1.46000277.7036087c-.51664349-.3971969-.97628006-.8648778-1.36452491-1.388658l.72932886-1.4472029c-.2203328-.39633993-.39395403-.82222042-.51342462-1.27020241l-1.52968981-.53381682c-.03892294-.29882066-.05900023-.60356226-.05900023-.91299317 0-.35132769.02588228-.69661025.07584411-1.03404495l1.53911115-.50785434c.12730646-.44544792.30839026-.86820077.53578009-1.26078723l-.70360861-1.46000277c.39719686-.51664349.86487779-.97628006 1.388658-1.36452491l1.44720284.72932886c.39633995-.2203328.82222044-.39395403 1.27020243-.51342462l.53381682-1.52968981c.29882066-.03892294.60356226-.05900023.91299317-.05900023z" stroke-width=".933"/><circle cx="7.5" cy="7.5" r="3"/></g></svg>
                        </button>

                    </div>
                </div>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="loading hidden" id="loadingMessage">
                Loading...
            </div>
            
            <div class="no-results hidden" id="noResults">
                No photographers found matching your search.
            </div>
            
            <div class="grid" id="contentGrid"></div>
        </div>
    </div>

    <!-- Preferences Modal -->
    <div class="preferences-modal" id="preferencesModal">
        <div class="preferences-content">
            <div class="preferences-header">
                <h2>Preferences</h2>
                <button class="preferences-close" id="preferencesClose">×</button>
            </div>
            
            <div class="preference-item">
                <label>Photography Folder</label>
                <div class="current-folder" id="currentFolderPath">No folder selected</div>
                <div class="preference-buttons">
                    <button class="change-folder-button" id="changeFolderButton">Change Folder</button>
                    <button class="reset-folder-button" id="resetFolderButton">Reset</button>
                </div>
            </div>
            
            <div class="preference-item">
                <label>Theme</label>
                <select class="theme-selector" id="themeSelector">
                    <option value="auto">Auto (System)</option>
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                </select>
            </div>
            
            <div class="preference-item">
                <label>Gallery Style</label>
                <select class="gallery-style-selector" id="galleryStyleSelector">
                    <option value="default">Default</option>
                    <option value="magazine">Magazine</option>
                </select>
            </div>
            
            <div class="preference-item">
                <label>
                    <input type="checkbox" class="hex-toggle" id="hexToggle">
                    Show hex values in eyedropper
                </label>
            </div>
            
            <div class="preferences-footer">
                <button class="confirm-button" id="confirmButton">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Image Viewer Modal -->
    <div class="image-viewer" id="imageViewer">
        <div class="viewer-content">
            <div class="viewer-main">
                <img class="viewer-image" id="viewerImage" src="" alt="">
                <canvas class="viewer-canvas" id="viewerCanvas" style="display: none;"></canvas>
            </div>
        </div>
        <div class="rgb-display" id="rgbDisplay">
            <span class="rgb-value r-value" id="rValue">---</span>
            <span class="rgb-value g-value" id="gValue">---</span>
            <span class="rgb-value b-value" id="bValue">---</span>
            <span class="rgb-value" id="lValue">---</span>
            <span class="rgb-value hex-value" id="hexValue">#------</span>
        </div>
        
        <div class="histogram-display" id="histogramDisplay">
            <div class="histogram-header"></div>
            <canvas class="histogram-canvas" id="histogramCanvas" width="256" height="100"></canvas>
        </div>
    </div>

    <script>
      // API compatibility layer for Electron → Tauri migration
      // Using Tauri's internal IPC API
      const invoke = window.__TAURI_INTERNALS__.invoke;

      // convertFileSrc implementation for Tauri 2
      function convertFileSrc(filePath) {
        // Use Tauri's internal convertFileSrc if available
        if (window.__TAURI_INTERNALS__?.convertFileSrc) {
          return window.__TAURI_INTERNALS__.convertFileSrc(filePath);
        }

        // Fallback: Tauri 2 asset protocol format
        const path = filePath.replace(/\\/g, '/');
        // Remove leading slash for proper URL construction
        const cleanPath = path.startsWith('/') ? path.slice(1) : path;
        return `https://asset.localhost/${cleanPath}`;
      }

      window.electronAPI = {
        selectDirectory: () => invoke('select_directory'),
        getPhotographers: (rootPath) => invoke('get_photographers', { rootPath }),
        getImages: (folderPath) => invoke('get_images', { folderPath }),
        getStoredFolder: () => invoke('get_stored_folder'),
        clearStoredFolder: () => invoke('clear_stored_folder'),
        getTheme: () => invoke('get_theme'),
        setTheme: (theme) => invoke('set_theme', { theme }),
        getShowHex: () => invoke('get_show_hex'),
        setShowHex: (showHex) => invoke('set_show_hex', { showHex }),
        getEyedropperActive: () => invoke('get_eyedropper_active'),
        setEyedropperActive: (active) => invoke('set_eyedropper_active', { active }),
        getHistogramActive: () => invoke('get_histogram_active'),
        setHistogramActive: (active) => invoke('set_histogram_active', { active }),
        getGalleryStyle: () => invoke('get_gallery_style'),
        setGalleryStyle: (galleryStyle) => invoke('set_gallery_style', { galleryStyle }),
        revealInFinder: (filePath) => invoke('reveal_in_finder', { filePath })
      }

      window.convertFileSrc = convertFileSrc;
    </script>
    <script src="js/constants.js"></script>
    <script src="js/dom-helper.js"></script>
    <script src="js/app.js"></script>
</body>
</html>